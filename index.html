<!doctypehtml><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Mood</title><script src=https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js></script><script src=js/audio-chain-system.js></script><script src=js/melody-instruments.js></script><script src=js/multi-melody-system.js></script><script src=js/sound-engines.js></script><script src=js/ocean-waves.js></script><script src=js/grandfather-clock.js></script><script src=js/thunder-system.js></script><script src=js/sleep-manager.js></script><script src=js/preset-manager.js></script><link rel=stylesheet href=css/style.css><div class=container><div class=header><h1>mood</h1></div><div class=big-play-section><button class=big-play-button id=playBtn>▶️</button><div class=quick-actions><button class=quick-btn id=dice-button><span>🎲</span> Random</button> <button class="quick-btn sleep"id=sleepBtn><span id=sleepIcon>😴</span> <span id=sleepText>Sleep</span></button></div></div><div class=current-settings><div class=current-title>Current Configuration</div><div class=current-values><div class=current-item><div class=current-label>Engine</div><div class=current-value id=current-engine>Standard</div></div><div class=current-item><div class=current-label>Mood</div><div class=current-value id=current-mood>Calm</div></div><div class=current-item><div class=current-label>Instrument</div><div class=current-value id=current-instrument>Piano</div></div><div class=current-item><div class=current-label>Ambient</div><div class=current-value id=current-ambient>None</div></div></div></div><div class=expandable-section><button class=section-toggle><div class=toggle-left><span class=section-icon>⭐</span> <span>Quick Presets</span></div><span class=toggle-indicator>▼</span></button><div class=section-content><div class=section-inner><div class=preset-row><div class=preset-pill data-preset=evolving title=Evolving>♾️</div><div class=preset-pill data-preset=star title="Shooting Star">🌠</div><div class=preset-pill data-preset=storm title="Gathering Storm">🌧️</div><div class=preset-pill data-preset=jewel title="Shining Jewel">💎</div><div class=preset-pill data-preset=minimal-drift title="Minimal Drift">🌱</div><div class=preset-pill data-preset=puzzle title="Taunting Puzzle">🧩</div><div class=preset-pill data-preset=forest title="Forest Depths">🌲</div><div class=preset-pill data-preset=frost title="Burning Frost">❄️</div><div class=preset-pill data-preset=crystal-cascade title="Crystal Cascade">💍</div><div class="preset-pill active"data-preset=classic title="The O.G.">1️⃣</div></div></div></div></div><div class=expandable-section><button class=section-toggle><div class=toggle-left><span class=section-icon>🎵</span> <span>Music & Sound Engine</span></div><span class=toggle-indicator>▼</span></button><div class=section-content><div class=section-inner><div class=simple-control><div class=simple-label>Sound Engine</div><select class=simple-select id=sound-engine><option value=random>Random (Auto-changing)<option value=standard selected>Standard Ambient<option value=cathedral-ethereal>Ethereal Cathedral<option value=glacial-ethereal>Glacial Ethereal<option value=dark-matter>Dark Matter<option value=aurora-field>Aurora Field<option value=glass-horizon>Glass Horizon<option value=nebula-drift>Nebula Drift<option value=thermal-layers>Thermal Layers<option value=deep-resonance>Deep Resonance<option value=cosmic-drift>Cosmic Drift<option value=underwater-palace>Underwater Palace<option value=neon-nocturne>Neon Nocturne<option value=atmospheric-temple>Atmospheric Temple<option value=stone-focus>Stone in Focus<option value=string-theory>String Theory<option value=hexagon-sun>Hexagon Sun<option value=parallel-dimension>Parallel Dimension<option value=gentle-rhubarb>Gentle Rhubarb<option value=ethereal-rhubarb>Ethereal Rhubarb</select></div><div class=simple-control><div class=simple-label>Musical Mood</div><select class=simple-select id=mood><option value=random>Random (Auto-changing)<option value=calm selected>Calm<option value=ethereal>Ethereal<option value=mysterious>Mysterious<option value=melancholic>Melancholic<option value=hopeful>Hopeful<option value=dreamy>Dreamy<option value=nostalgic>Nostalgic<option value=peaceful>Peaceful<option value=serene>Serene<option value=meditative>Meditative<option value=dramatic>Dramatic<option value=celestial>Celestial<option value=earthy>Earthy<option value=twilight>Twilight<option value=awakening>Awakening<option value=wandering>Wandering<option value=introspective>Introspective<option value=ethereal_bright>Ethereal-bright<option value=oceanic>Oceanic</select></div><div class=simple-control><div class=simple-label>Note Density</div><input type=range class=simple-slider id=density min=1 max=10 value=5><div class=slider-info><span>Sparse</span> <span>Dense</span></div></div><div class=simple-control><div class=simple-label>Reverb Amount</div><input type=range class=simple-slider id=reverb min=0 max=1 step=0.1 value=0.5><div class=slider-info><span>Dry</span> <span>Wet</span></div></div></div></div></div><div class=expandable-section><button class=section-toggle><div class=toggle-left><span class=section-icon>🎹</span> <span>Melodic Instruments</span></div><span class=toggle-indicator>▼</span></button><div class=section-content><div class=section-inner><div class=simple-control><div class=simple-label>Melodic Instruments</div><label style=display:flex;align-items:center;gap:8px;margin-bottom:10px;font-size:.8rem><input type=checkbox id=melody-toggle checked> Enable Melodic Instruments</label></div><div class=simple-control><div class=simple-label>Instrument Selection</div><select class=simple-select id=melodic-instrument><option value=random>Random (Auto-changing)<option value=piano selected>Soft Piano (All Layers)<option value=rhythmic-piano>Rhythmic Piano (All Layers)<option value=algorithmic-melody>Algorithmic Melody (All Layers)<option value=marimba>Marimba (All Layers)<option value=harp>Harp (All Layers)<option value=music-box>Music Box (All Layers)<option value=glitch-electronic>Glitch Electronic (All Layers)<option value=crystal-bells>Crystal Bells (All Layers)<option value=warm-strings>Warm Strings (All Layers)<option value=ethereal-choir>Ethereal Choir (All Layers)<option value=wind-chimes>Wind Chimes (All Layers)<option value=glass-harmonics>Glass Harmonics (All Layers)<option value=soft-flute>Soft Flute (All Layers)<option value=vintage-celesta>Vintage Celesta (All Layers)<option value=deep-bass-melodic>Deep Bass Melodic (All Layers)<option value=arpeggiator>Arpeggiator (All Layers)<option value=mixed>Mixed (Different Per Layer)</select></div><div class=simple-control><div class=control-header-with-protection><div class=simple-label>Number of Melody Layers</div><div class=protection-controls><div class=enable-checkbox><input type=checkbox id=melody-layers-enable> <label for=melody-layers-enable class=checkbox-label>Enable Advanced</label></div></div></div><div class="cpu-warning hidden"id=melody-layers-warning><div class=warning-icon>⚠️</div><div class=warning-text><strong>Warning:</strong> High melody layer counts can cause significant CPU usage.</div></div><input type=range class=simple-slider id=melody-slot-count min=1 max=3 value=1 disabled><div class=slider-info><span>1 Layer</span> <span>3 Layers</span></div></div><div class=simple-control><div class=simple-label>Active Melody Layers</div><div id=melody-slots-info class=slots-info><div class="slot-info active"><span class=slot-label>Layer 1:</span> <span class=slot-instrument>Piano</span> <span class=slot-status>♪</span></div></div></div><div class=simple-control><div class=simple-label>Global Note Frequency</div><input type=range class=simple-slider id=melodic-frequency min=1 max=10 value=6><div class=slider-info><span>Rare</span> <span>Often</span></div></div><div class=simple-control><div class=simple-label>Melodic Reverb</div><input type=range class=simple-slider id=melodic-reverb min=0 max=1 step=0.05 value=0.8><div class=slider-info><span>Dry</span> <span>Wet</span></div></div><div class=simple-control><div class=simple-label>Layer Randomness</div><input type=range class=simple-slider id=layer-randomness min=0 max=1 step=0.1 value=0.5><div class=slider-info><span>Synchronized</span> <span>Chaotic</span></div></div></div></div></div><div class=expandable-section><button class=section-toggle><div class=toggle-left><span class=section-icon>🌊</span> <span>Environmental Sounds</span></div><span class=toggle-indicator>▼</span></button><div class=section-content><div class=section-inner><div class=ambient-toggles><div class=ambient-toggle data-sound=waves><span class=ambient-emoji>🌊</span> <span class=ambient-text>Ocean<br>Waves</span> <button class=ambient-settings-btn>⚙️</button></div><div class=ambient-toggle data-sound=clock><span class=ambient-emoji>🕰️</span> <span class=ambient-text>Clock<br>Ticking</span> <button class=ambient-settings-btn>⚙️</button></div><div class=ambient-toggle data-sound=thunder><span class=ambient-emoji>⛈️</span> <span class=ambient-text>Thunder<br>Storm</span> <button class=ambient-settings-btn>⚙️</button></div></div><div class=ambient-settings-panel id=waves-settings><div class=ambient-settings-title><span>🌊</span> Ocean Waves Configuration</div><div class=simple-control><div class=simple-label>Wave Volume</div><input type=range class=simple-slider id=noise-volume min=-15 max=5 step=1 value=-6><div class=slider-info><span>Quiet</span> <span>Loud</span></div></div><div class=settings-grid><div class=settings-group><div class=settings-group-title>Wave Character</div><div class=mini-control><div class=mini-label>Base Level</div><input type=range class=mini-slider id=base-level min=0 max=0.3 step=0.01 value=0.05><div class=mini-range><span>Silent</span> <span>Audible</span></div></div><div class=mini-control><div class=mini-label>Peak Level</div><input type=range class=mini-slider id=peak-level min=0.1 max=0.8 step=0.01 value=0.4><div class=mini-range><span>Gentle</span> <span>Powerful</span></div></div><div class=mini-control><div class=mini-label>Build Speed</div><input type=range class=mini-slider id=build-speed min=0.5 max=5 step=0.1 value=2><div class=mini-range><span>Slow</span> <span>Fast</span></div></div><div class=mini-control><div class=mini-label>Noise Type</div><select class=mini-select id=noise-type><option value=white>White<option value=pink selected>Pink<option value=brown>Brown</select></div></div><div class=settings-group><div class=settings-group-title>Timing & Filter</div><div class=mini-control><div class=mini-label>Min Duration</div><input type=range class=mini-slider id=min-duration min=2 max=15 step=0.5 value=4><div class=mini-range><span>2s</span> <span>15s</span></div></div><div class=mini-control><div class=mini-label>Max Duration</div><input type=range class=mini-slider id=max-duration min=5 max=25 step=0.5 value=12><div class=mini-range><span>5s</span> <span>25s</span></div></div><div class=mini-control><div class=mini-label>Pause Between</div><input type=range class=mini-slider id=pause-between min=0.5 max=8 step=0.25 value=2><div class=mini-range><span>0.5s</span> <span>8s</span></div></div><div class=mini-control><div class=mini-label>Filter Frequency</div><input type=range class=mini-slider id=filter-freq min=200 max=8000 step=50 value=2000><div class=mini-range><span>200Hz</span> <span>8kHz</span></div></div></div></div></div><div class=ambient-settings-panel id=clock-settings><div class=ambient-settings-title><span>🕰️</span> Grandfather Clock Configuration</div><div class=simple-control><div class=simple-label>Clock Volume</div><input type=range class=simple-slider id=clock-volume min=-20 max=0 step=1 value=-6><div class=slider-info><span>Quiet</span> <span>Loud</span></div></div><div class=settings-grid><div class=settings-group><div class=settings-group-title>Clock Character</div><div class=mini-control><div class=mini-label>Tempo (BPM)</div><input type=range class=mini-slider id=clock-tempo min=30 max=120 step=1 value=60><div class=mini-range><span>30</span> <span>120</span></div></div><div class=mini-control><div class=mini-label>Tick Brightness</div><input type=range class=mini-slider id=clock-brightness min=800 max=4000 step=50 value=2000><div class=mini-range><span>Warm</span> <span>Bright</span></div></div><div class=mini-control><div class=mini-label>Wood Resonance</div><input type=range class=mini-slider id=clock-resonance min=0.5 max=15 step=0.5 value=8><div class=mini-range><span>Muted</span> <span>Resonant</span></div></div></div><div class=settings-group><div class=settings-group-title>Ambient Processing</div><div class=mini-control><div class=mini-label>Reverb Amount</div><input type=range class=mini-slider id=clock-reverb min=0 max=1 step=0.05 value=0.8><div class=mini-range><span>Dry</span> <span>Wet</span></div></div><div class=mini-control><div class=mini-label>Reverb Decay</div><input type=range class=mini-slider id=clock-decay min=5 max=40 step=1 value=25><div class=mini-range><span>5s</span> <span>40s</span></div></div><div class=mini-control><div class=mini-label>Current Tempo</div><div id=clock-tempo-display style="background:rgba(139,69,19,.3);border-radius:4px;padding:4px 6px;text-align:center;font-size:.7rem;color:gold;border:1px solid rgba(255,215,0,.3)">60 BPM</div></div></div></div></div><div class=ambient-settings-panel id=thunder-settings><div class=ambient-settings-title><span>⛈️</span> Thunder Storm Configuration</div><div class=simple-control><div class=simple-label>Storm Volume</div><input type=range class=simple-slider id=thunder-volume min=-20 max=0 step=1 value=0><div class=slider-info><span>Quiet</span> <span>Loud</span></div></div><div class=settings-grid><div class=settings-group><div class=settings-group-title>Thunder Settings</div><div class=mini-control><div class=mini-label>Thunder Intensity</div><input type=range class=mini-slider id=thunder-intensity min=0.3 max=1.0 step=0.1 value=0.7><div class=mini-range><span>Gentle</span> <span>Powerful</span></div></div><div class=mini-control><div class=mini-label>Thunder Distance</div><input type=range class=mini-slider id=thunder-distance min=0.1 max=1.0 step=0.1 value=0.5><div class=mini-range><span>Close</span> <span>Distant</span></div></div><div class=mini-control><div class=mini-label>Thunder Frequency</div><input type=range class=mini-slider id=thunder-frequency min=2 max=15 step=1 value=8><div class=mini-range><span>Frequent</span> <span>Rare</span></div></div></div><div class=settings-group><div class=settings-group-title>Rain Settings</div><div class=mini-control><div class=mini-label>Rain Volume</div><input type=range class=mini-slider id=thunder-rain-volume min=0.1 max=0.4 step=0.05 value=0.2><div class=mini-range><span>Light</span> <span>Heavy</span></div></div><div class=mini-control><div class=mini-label>Rain Type</div><select class=mini-select><option>Light Drizzle<option selected>Steady Rain<option>Heavy Downpour</select></div></div></div></div></div></div></div><div class=expandable-section><button class=section-toggle><div class=toggle-left><span class=section-icon>⚙️</span> <span>Audio Settings</span></div><span class=toggle-indicator>▼</span></button><div class=section-content><div class=section-inner><div class=simple-control><div class=simple-label>Master Volume</div><input type=range class=simple-slider id=volume min=-30 max=0 step=1 value=-15><div class=slider-info><span>🔇 Quiet</span> <span>Loud 🔊</span></div></div><div class=simple-control><div class=simple-label>Random Change Interval</div><input type=range class=simple-slider id=random-interval min=1 max=30 step=1 value=10><div class=slider-info><span>1 min</span> <span>30 min</span></div></div></div></div></div><div class=mini-visualizer><div class=waves-container id=waves></div></div><div class=info><p>By <a href=https://github.com/mrbarge/mood>mrbarge</a>, with ❤️ to <a href=https://tonejs.github.io/ >tone.js</a></div></div><script>let musicManager=null,melodyManager=null,waveManager=null,clockManager=null,sleepManager=null,thunderManager=null,presetManager=null,clockInitialized=!1,isPlaying=!1,activeNotes={},currentActiveMood="calm",visualizerInterval=null,masterVolume=new Tone.Volume(-15).toDestination(),reverb=new Tone.Reverb({decay:10,wet:.5,preDelay:.01}).connect(masterVolume),delay=new Tone.FeedbackDelay({delayTime:"8n",feedback:.4,wet:.3}).connect(reverb),filter=new Tone.Filter({type:"lowpass",frequency:2e3,Q:1}).connect(delay),playBtn=document.getElementById("playBtn"),sleepBtn=document.getElementById("sleepBtn"),diceButton=document.getElementById("dice-button"),scales={calm:["C3","D3","E3","G3","A3","C4","D4","E4","G4","A4","C5"],ethereal:["D3","F#3","A3","B3","D4","F#4","A4","B4","D5"],mysterious:["C3","D#3","F3","G#3","B3","C4","D#4","F4","G#4","B4"],melancholic:["A2","C3","D3","E3","F3","A3","C4","D4","E4","F4","A4"],hopeful:["G3","A3","B3","D4","E4","G4","A4","B4","D5","E5"],dreamy:["C3","D3","E3","F#3","G3","A3","B3","C4","D4","E4","F#4","G4","A4","B4","C5"],nostalgic:["A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4"],peaceful:["D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5"],serene:["C3","D3","E3","G3","A3","C4","D4","E4","G4","A4","C5","D5","E5","G5"],meditative:["C3","D3","E3","G3","A3","C4","D4","E4","G4","A4","C5","D5","E5"],dramatic:["A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4"],celestial:["C3","E3","F#3","G3","B3","C4","E4","F#4","G4","B4","C5","E5","F#5","G5"],earthy:["G2","A2","B2","D3","E3","G3","A3","B3","D4","E4","G4","A4","B4"],twilight:["B2","C3","D3","F3","G3","A3","B3","C4","D4","F4","G4","A4","B4","C5"],awakening:["D3","F#3","G3","A3","B3","D4","F#4","G4","A4","B4","D5","F#5","G5"],wandering:["G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5"],introspective:["A2","C3","D3","E3","G3","A3","C4","D4","E4","G4","A4","C5","D5"],ethereal_bright:["E3","F#3","G#3","A3","B3","D4","E4","F#4","G#4","A4","B4","D5","E5"],oceanic:["C3","D3","F3","G3","A3","C4","D4","F4","G4","A4","C5","D5","F5"],sacred:["F3","G3","A3","Bb3","C4","D4","E4","F4","G4","A4","Bb4","C5","D5","E5"]},melodicPatterns={calm:["E4","G4","C5"],ethereal:["F#4","B4","D5"],mysterious:["D#4","G#4","C5"],melancholic:["C4","E4","A4"],hopeful:["B4","D5","G4"],dreamy:["E4","F#4","A4","B4"],nostalgic:["C4","E4","F4","A4"],peaceful:["D4","F4","A4","C5"],serene:["E4","G4","C5"],meditative:["E4","G4","A4"],dramatic:["C4","F4","A4","C5"],celestial:["E4","F#4","B4","C5"],earthy:["D4","G4","A4"],twilight:["F4","G4","A4","C5"],awakening:["F#4","A4","B4","D5"],wandering:["C4","E4","F4","G4"],introspective:["C4","E4","G4"],ethereal_bright:["G#4","B4","D5"],oceanic:["F4","G4","C5"],sacred:["A4","C5","D5","F5"]};function updateCurrentSettings(){var e=document.getElementById("sound-engine").selectedOptions[0].text,e=(document.getElementById("current-engine").textContent=e.includes("Random")?"Random":e.split(" ")[0],document.getElementById("mood")),e=e.selectedOptions[0].text,e=(document.getElementById("current-mood").textContent=e.includes("Random")?"Random":e,document.getElementById("melodic-instrument"));let t="None";document.getElementById("melody-toggle").checked&&(t=e.selectedOptions[0].text.includes("Random")?"Random":e.selectedOptions[0].text.split(" ")[0]),document.getElementById("current-instrument").textContent=t;e=Array.from(document.querySelectorAll(".ambient-toggle.active")).map(e=>e.querySelector(".ambient-text").textContent.split("\n")[0]).join(", ");document.getElementById("current-ambient").textContent=e||"None"}function updatePlayButton(e){e?(playBtn.innerHTML="⏹️",playBtn.classList.add("stop")):(playBtn.innerHTML="▶️",playBtn.classList.remove("stop"))}function animateWaves(){document.querySelectorAll(".wave").forEach((e,t)=>{var n=60*Math.random()+20;e.style.height=n+"%"})}function startVisualizer(){visualizerInterval&&clearInterval(visualizerInterval),visualizerInterval=setInterval(animateWaves,300),animateWaves()}async function startMusic(){if(!isPlaying){console.log("🎵 Starting ambient music system...");try{await Tone.start(),isPlaying=!0,activeNotes={},musicManager=musicManager||new AmbientMusicManager,melodyManager=melodyManager||new MultiMelodyManager,waveManager=waveManager||new OceanWaveManager,clockManager=clockManager||new GrandfatherClockManager,sleepManager=sleepManager||new SleepModeManager,thunderManager=thunderManager||new ThunderStormManager;var e,t,n,a,o,l,r=document.getElementById("sound-engine"),s=r.value,d=("random"!==s?await musicManager.setSoundEngine(s,{density:parseInt(document.getElementById("density").value),reverbAmount:parseFloat(document.getElementById("reverb").value)}):(t=(e=musicManager.getAvailableSoundEngines())[Math.floor(Math.random()*e.length)],await musicManager.setSoundEngine(t.key,{density:parseInt(document.getElementById("density").value),reverbAmount:parseFloat(document.getElementById("reverb").value)})),document.getElementById("mood")),i=(currentActiveMood="random"!==d.value?d.value:(n=musicManager.getAvailableMoods())[Math.floor(Math.random()*n.length)],musicManager.setMood(currentActiveMood),"random"===d.value&&(musicManager.startRandomMoodCycle(),console.log("🎵 Started mood random cycle")),"random"===r.value&&(musicManager.startRandomEngineCycle(),console.log("🎵 Started mood engine cycle")),reverb.wet.value=parseFloat(document.getElementById("reverb").value),masterVolume.volume.value=parseInt(document.getElementById("volume").value),Tone.Transport.bpm.value=60,Tone.Transport.start(),await musicManager.start(),document.getElementById("melody-toggle"));i.checked&&melodyManager&&(0===melodyManager.getCurrentSlotCount()&&melodyManager.initializeSlots(1),"random"!==(a=document.getElementById("melodic-instrument").value)?await melodyManager.setAllSlotsToInstrument(a,{reverbAmount:parseFloat(document.getElementById("melodic-reverb").value)}):await melodyManager.randomizeSlotInstruments(),o=scales[currentActiveMood],l=melodicPatterns[currentActiveMood],o&&l&&await melodyManager.start(o,l),"random"===a)&&(melodyManager.startRandomCycle(),console.log("🎵 Started melody random cycle")),document.querySelectorAll(".ambient-toggle.active").forEach(e=>{e=e.dataset.sound;"waves"===e&&waveManager?waveManager.toggle():"clock"===e&&clockManager?clockManager.toggle():"thunder"===e&&thunderManager&&thunderManager.toggle()}),startVisualizer(),console.log("✅ Music started successfully!")}catch(e){console.error("❌ Error starting music:",e),isPlaying=!1}}}function stopMusic(){console.log("🛑 Stopping ambient music system..."),isPlaying=!1,musicManager&&musicManager.stop(),melodyManager&&melodyManager.stop(),waveManager&&document.querySelector('.ambient-toggle[data-sound="waves"]').classList.contains("active")&&waveManager.toggle(),clockManager&&document.querySelector('.ambient-toggle[data-sound="clock"]').classList.contains("active")&&(console.log("Stopping clock"),clockManager.toggle()),thunderManager&&document.querySelector('.ambient-toggle[data-sound="thunder"]').classList.contains("active")&&thunderManager.toggle(),Tone.Transport.stop(),visualizerInterval&&(clearInterval(visualizerInterval),visualizerInterval=null),activeNotes={},console.log("✅ Music stopped successfully")}document.querySelectorAll(".section-toggle").forEach(n=>{n.addEventListener("click",()=>{var e=n.nextElementSibling,t=n.classList.contains("active");document.querySelectorAll(".section-toggle").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".section-content").forEach(e=>e.classList.remove("active")),t||(n.classList.add("active"),e.classList.add("active"))})}),document.querySelectorAll(".preset-pill").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".preset-pill").forEach(e=>e.classList.remove("active")),e.classList.add("active"),updateCurrentSettings()})}),document.querySelectorAll(".ambient-toggle").forEach(a=>{a.addEventListener("click",n=>{if(n.target.classList.contains("ambient-settings-btn")){n.stopPropagation();let e=a.dataset.sound,t=document.getElementById(e+"-settings");document.querySelectorAll(".ambient-settings-panel").forEach(e=>{e!==t&&e.classList.remove("active")}),void t.classList.toggle("active")}else{n=a.classList.contains("active");a.classList.toggle("active");let e=a.dataset.sound;"waves"===e?(console.log("hdasdfasdf"),waveManager&&waveManager.toggle()):"clock"===e?clockManager&&clockManager.toggle():"thunder"===e&&thunderManager&&thunderManager.toggle(),n&&document.getElementById(e+"-settings").classList.remove("active"),updateCurrentSettings()}})}),document.getElementById("melody-layers-enable").addEventListener("change",function(){var e=document.getElementById("melody-slot-count"),t=document.getElementById("melody-layers-warning");e.disabled=!this.checked,this.checked?t.classList.remove("hidden"):(t.classList.add("hidden"),e.value="1")}),document.getElementById("clock-tempo").addEventListener("input",function(){document.getElementById("clock-tempo-display").textContent=this.value+" BPM"}),document.getElementById("sound-engine").addEventListener("change",updateCurrentSettings),document.getElementById("mood").addEventListener("change",updateCurrentSettings),document.getElementById("melodic-instrument").addEventListener("change",updateCurrentSettings),document.getElementById("melody-toggle").addEventListener("change",updateCurrentSettings),playBtn.addEventListener("click",()=>{isPlaying?(stopMusic(),updatePlayButton(!1)):(startMusic(),updatePlayButton(!0))}),sleepBtn.addEventListener("click",()=>{var e,t;sleepManager&&(sleepManager.toggle(),sleepBtn.classList.toggle("active"),e=document.getElementById("sleepIcon"),t=document.getElementById("sleepText"),sleepBtn.classList.contains("active")?(e.textContent="😴",t.textContent="Wake"):(e.textContent="😴",t.textContent="Sleep"))}),document.addEventListener("DOMContentLoaded",function(){console.log("🎵 Initializing Mood App..."),(melodyManager=new MultiMelodyManager).initializeSlots(1);var e=document.getElementById("melody-toggle"),e=(e&&(melodyManager.setEnabled(e.checked),e.addEventListener("change",async function(){if(melodyManager.setEnabled(this.checked),console.log("🎵 Melody manager "+(this.checked?"enabled":"disabled")),this.checked&&isPlaying)try{0===melodyManager.getCurrentSlotCount()&&melodyManager.initializeSlots(1);var e=document.getElementById("melodic-instrument").value,t=("random"!==e?await melodyManager.setAllSlotsToInstrument(e,{reverbAmount:parseFloat(document.getElementById("melodic-reverb").value||.8)}):await melodyManager.randomizeSlotInstruments(),void 0!==currentActiveMood?currentActiveMood:"random"===document.getElementById("mood").value?"calm":document.getElementById("mood").value);scales[t]&&melodicPatterns[t]&&await melodyManager.start(scales[t],melodicPatterns[t]),console.log("🎵 Melody restarted after re-enabling")}catch(e){console.error("🎵 Error restarting melody:",e)}updateCurrentSettings()})),document.getElementById("melodic-instrument")),e=(e&&e.addEventListener("change",async function(){if(melodyManager&&melodyManager.isEnabled&&isPlaying){console.log("🎵 Changing instrument to: "+this.value);try{"random"!==this.value?await melodyManager.setAllSlotsToInstrument(this.value,{reverbAmount:parseFloat(document.getElementById("melodic-reverb").value||.8)}):(await melodyManager.randomizeSlotInstruments(),melodyManager.startRandomCycle());var e=void 0!==currentActiveMood?currentActiveMood:"random"===document.getElementById("mood").value?"calm":document.getElementById("mood").value;scales[e]&&melodicPatterns[e]&&await melodyManager.start(scales[e],melodicPatterns[e]),updateCurrentSettings()}catch(e){console.error("🎵 Error changing instrument:",e)}}}),document.getElementById("mood")),e=(e&&e.addEventListener("change",function(){var e,t;musicManager&&isPlaying&&("random"!==this.value?(musicManager.setMood(this.value),currentActiveMood=this.value,melodyManager&&melodyManager.isEnabled&&(e=scales[this.value],t=melodicPatterns[this.value],e)&&t&&melodyManager.setScaleAndPattern(e,t)):musicManager.startRandomMoodCycle()),updateCurrentSettings()}),document.getElementById("density")),e=(e&&e.addEventListener("input",function(){musicManager&&musicManager.currentSoundEngine&&isPlaying&&musicManager.updateConfig({density:parseInt(this.value)}),updateCurrentSettings()}),document.getElementById("reverb")),e=(e&&e.addEventListener("input",function(){musicManager&&musicManager.currentSoundEngine&&isPlaying&&musicManager.updateConfig({reverbAmount:parseFloat(this.value)}),void 0!==reverb&&(reverb.wet.value=parseFloat(this.value)),updateCurrentSettings()}),document.getElementById("sound-engine")),t=(e&&e.addEventListener("change",async function(){if(musicManager&&isPlaying){console.log("🎵 Changing sound engine to: "+this.value);try{var e,t;"random"!==this.value?await musicManager.setSoundEngine(this.value,{density:parseInt(document.getElementById("density").value||5),reverbAmount:parseFloat(document.getElementById("reverb").value||.5)}):0<(e=musicManager.getAvailableSoundEngines()).length&&(t=e[Math.floor(Math.random()*e.length)],await musicManager.setSoundEngine(t.key,{density:parseInt(document.getElementById("density").value||5),reverbAmount:parseFloat(document.getElementById("reverb").value||.5)}),musicManager.startRandomEngineCycle()),updateCurrentSettings(),console.log("🎵 Sound engine changed successfully")}catch(e){console.error("🎵 Error changing sound engine:",e)}}else isPlaying||updateCurrentSettings()}),document.getElementById("waves"));for(let e=0;e<20;e++){var n=document.createElement("div");n.className="wave",t.appendChild(n)}"undefined"!=typeof PresetManager&&(presetManager=new PresetManager),diceButton.addEventListener("click",function(){console.log("🎲 Starting randomization..."),this.style.transform="scale(0.95)",this.innerHTML="<span>🎲</span> Rolling...",setTimeout(async()=>{try{var e=document.getElementById("mood"),t=Array.from(e.options).filter(e=>"random"!==e.value),n=t[Math.floor(Math.random()*t.length)],a=(e.value=n.value,e.dispatchEvent(new Event("change",{bubbles:!0})),document.getElementById("sound-engine")),o=Array.from(a.options).filter(e=>"random"!==e.value),l=o[Math.floor(Math.random()*o.length)],r=(a.value=l.value,a.dispatchEvent(new Event("change",{bubbles:!0})),document.getElementById("melodic-instrument")),s=Array.from(r.options).filter(e=>"random"!==e.value),d=s[Math.floor(Math.random()*s.length)],i=(r.value=d.value,r.dispatchEvent(new Event("change",{bubbles:!0})),document.getElementById("density")),c=(i.value=Math.floor(8*Math.random())+2,i.dispatchEvent(new Event("input",{bubbles:!0})),document.getElementById("reverb")),u=(c.value=(.8*Math.random()+.2).toFixed(1),c.dispatchEvent(new Event("input",{bubbles:!0})),document.getElementById("melodic-frequency")),m=(u.value=Math.floor(8*Math.random())+2,u.dispatchEvent(new Event("input",{bubbles:!0})),document.getElementById("melodic-reverb"));m.value=(.6*Math.random()+.4).toFixed(2),m.dispatchEvent(new Event("input",{bubbles:!0})),document.querySelectorAll(".ambient-toggle").forEach(e=>{.6<Math.random()!==e.classList.contains("active")&&e.click()}),updateCurrentSettings(),console.log("✅ Randomization complete with live updates!")}catch(e){console.error("❌ Error during randomization:",e)}this.style.transform="scale(1)",this.innerHTML="<span>🎲</span> Random"},800)});e=document.getElementById("random-interval");e&&e.addEventListener("input",function(){var e;console.log(`🎲 Random interval changed to: ${this.value} minutes`),musicManager&&isPlaying&&musicManager.restartRandomCycles(),melodyManager&&isPlaying&&(melodyManager.randomInterval&&(clearInterval(melodyManager.randomInterval),melodyManager.randomInterval=null),e=document.getElementById("melodic-instrument"))&&"random"===e.value&&melodyManager.startRandomCycle()}),updateCurrentSettings(),console.log("✅ Mood App initialized successfully")})</script>